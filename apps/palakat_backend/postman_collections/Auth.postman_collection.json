{
  "info": {
    "name": "Auth API",
    "description": "Authentication endpoints",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "base_url",
      "value": "http://localhost:3000",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "Get Client Token (Signing)",
      "request": {
        "auth": {
          "type": "basic",
          "basic": [
            {
              "key": "username",
              "value": "client_id",
              "type": "string"
            },
            {
              "key": "password",
              "value": "client_secret",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/signing",
          "host": ["{{base_url}}"],
          "path": ["auth", "signing"]
        },
        "description": "Get client authentication token using Basic Auth with client credentials"
      }
    },
    {
      "name": "Sign In",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const response = pm.response.json();",
              "if (response.data && response.data.accessToken) {",
              "    pm.environment.set('access_token', response.data.accessToken);",
              "    pm.environment.set('refresh_token', response.data.refreshToken);",
              "    console.log('✅ Tokens saved to environment');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"identifier\": \"081111111111\",\n  \"password\": \"password\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/sign-in",
          "host": ["{{base_url}}"],
          "path": ["auth", "sign-in"]
        },
        "description": "Sign in with phone number or email and password. Automatically saves access_token and refresh_token to environment."
      }
    },
    {
      "name": "Refresh Token",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "const response = pm.response.json();",
              "if (response.data && response.data.accessToken) {",
              "    pm.environment.set('access_token', response.data.accessToken);",
              "    pm.environment.set('refresh_token', response.data.refreshToken);",
              "    console.log('✅ Tokens refreshed and saved');",
              "}"
            ],
            "type": "text/javascript"
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"refreshToken\": \"{{refresh_token}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/auth/refresh",
          "host": ["{{base_url}}"],
          "path": ["auth", "refresh"]
        },
        "description": "Refresh access token using refresh token. Automatically updates tokens in environment."
      }
    },
    {
      "name": "Validate Token",
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/validate?phone=081111111111",
          "host": ["{{base_url}}"],
          "path": ["auth", "validate"],
          "query": [
            {
              "key": "phone",
              "value": "081111111111",
              "description": "Optional: Check if phone number is available"
            }
          ]
        },
        "description": "Validate current JWT token and optionally check phone number availability"
      }
    },
    {
      "name": "Sign Out",
      "request": {
        "auth": {
          "type": "bearer",
          "bearer": [
            {
              "key": "token",
              "value": "{{access_token}}",
              "type": "string"
            }
          ]
        },
        "method": "POST",
        "header": [],
        "url": {
          "raw": "{{base_url}}/auth/sign-out",
          "host": ["{{base_url}}"],
          "path": ["auth", "sign-out"]
        },
        "description": "Sign out current user and invalidate refresh token"
      }
    }
  ]
}
